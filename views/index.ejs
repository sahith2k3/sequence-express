<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="/styles.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
</head>    
<body>
    <div class="gameArea">

        <div class="playArea">
                <div class="Users"> 
                    <h1> Players </h1>
            
                    <% for (let i = 0; i < users; i++){ %>
                        <div id="user<%= i %>" class="UserName">
                            User <%= i %>
                        </div> 

                    <% } %>
                </div>

                <div class="Hands">
                                        
                    <div class="hand-cards">
                        <% 
                        // Get 7 unique random card indices
                        const handIndices = [];
                        while (handIndices.length < 7) {
                            const randomIndex = Math.floor(Math.random() * Object.keys(boardData).length);
                            const randomKey = Object.keys(boardData)[randomIndex];
                            if (!handIndices.includes(randomKey)) {
                                handIndices.push(randomKey);
                            }
                        }

                        // Display the hand cards
                        for (let i = 0; i < handIndices.length; i++) { 
                            const cardKey = handIndices[i];
                        %>
                            <img class="hand_card" src="images/<%= boardData[cardKey] %>.png" alt="<%= boardData[cardKey] %>">
                        <% } %>
                    </div>
                </div>

        </div>

        <div class="content">
            <div class="board">    
                <table>
                    <% for (let i = 0; i < 10; i++) { %>
                    <tr>
                        <% for (let j = 0; j < 10; j++) { %>
                        <td>
                            <img class="card" src="images/<%= boardData[i + ',' + j] %>.png" alt="<%= boardData[i + ',' + j] %>">
                        </td>
                        <% } %>
                    </tr>
                    <% } %>
                </table>
            </div>
        </div>

    </div>

    <script>
        var x;
        var $cards = $(".hand_card");
        var $style = $(".hover");

        $cards
        .on("mousemove touchmove", function(e) { 
            // normalise touch/mouse
            var pos = [e.offsetX,e.offsetY];
            e.preventDefault();
            if ( e.type === "touchmove" ) {
            pos = [ e.touches[0].clientX, e.touches[0].clientY ];
            }
            var $card = $(this);
            // math for mouse position
            var l = pos[0];
            var t = pos[1];
            var h = $card.height();
            var w = $card.width();
            var px = Math.abs(Math.floor(100 / w * l)-100);
            var py = Math.abs(Math.floor(100 / h * t)-100);
            var pa = (50-px)+(50-py);
            // math for gradient / background positions
            var lp = (50+(px - 50)/1.5);
            var tp = (50+(py - 50)/1.5);
            var px_spark = (50+(px - 50)/7);
            var py_spark = (50+(py - 50)/7);
            var p_opc = 20+(Math.abs(pa)*1.5);
            var ty = ((tp - 50)/2) * -1;
            var tx = ((lp - 50)/1.5) * .5;
            // css to apply for active card
            var grad_pos = `background-position: ${lp}% ${tp}%;`
            var sprk_pos = `background-position: ${px_spark}% ${py_spark}%;`
            var opc = `opacity: ${p_opc/100};`
            var tf = `transform: rotateX(${ty}deg) rotateY(${tx}deg) translateY(-50px)`
            // need to use a <style> tag for psuedo elements
            var style = `
            .card:hover:before { ${grad_pos} }  /* gradient */
            .card:hover:after { ${sprk_pos} ${opc} }   /* sparkles */ 
            `
            // set / apply css class and style
            $cards.removeClass("active");
            $card.removeClass("animated");
            $card.attr( "style", tf );
            $style.html(style);
            if ( e.type === "touchmove" ) {
            return false; 
            }
            clearTimeout(x);
        }).on("mouseout touchend touchcancel", function() {
            // remove css, apply custom animation on end
            var $card = $(this);
            $style.html("");
            $card.removeAttr("style");
            x = setTimeout(function() {
            $card.addClass("animated");
            },2500);
        });
    </script>
</body>
</html>
